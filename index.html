<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>KMQR Generator - QR Code Creator</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="shortcut icon" href="icon.png" type="image/png">
  
  <!-- Apple iOS Home Screen Icon - Generated dynamically with white background -->
  <link rel="apple-touch-icon" id="app-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAA9zQYyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF8WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI2LTAyLTAyVDEwOjAwOjAwKzA3OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNi0wMi0wMlQxMDowMDowMCswNzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNi0wMi0wMlQxMDowMDowMCswNzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowMDAwMDAwMC0wMDAw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">
  <link rel="apple-touch-icon" sizes="180x180" id="app-icon-180" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAA9zQYyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF8WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDI2LTAyLTAyVDEwOjAwOjAwKzA3OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyNi0wMi0wMlQxMDowMDowMCswNzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNi0wMi0wMlQxMDowMDowMCswNzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowMDAwMDAwMC0wMDAw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">
  
  <!-- Apple PWA Settings -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="KMQR">
  
  <!-- Android/Chrome PWA -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0f172a">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Hanuman:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Siemreap&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      box-sizing: border-box;
      background: #0f172a;
      color: #e2e8f0;
      font-family: 'Siemreap', 'Hanuman', Arial, sans-serif;
    }

    .header-bar {
      overflow: visible;
      position: fixed;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100vw - 16px);
      max-width: 700px;
      z-index: 2000;
      height: auto;
      min-height: 100px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 2px 10px rgba(0,0,0,0.1);
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      backdrop-filter: blur(8px) saturate(180%);
      background: #ffffff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      margin: 0;
      padding: 8px 12px;
      box-sizing: border-box;
    }
    .header-bar > div {
      margin-top: 0 !important;
    }

    .header-bar .button-row {
      margin-top: 0px !important;
      z-index: 0;
    }

    .header-bar h1 {
      padding: 16px 0 8px 0;
      margin: 0;
      font-size: 36px;
      font-family: 'Segoe UI', Arial, sans-serif;
      font-style: normal;
      color: #1e40af;
      text-shadow: none;
      white-space: nowrap;
      font-weight: 700;
      letter-spacing: 3px;
      line-height: 1.1;
      text-align: center;
      z-index: 1;
      text-transform: uppercase;
    }

    .main-wrapper {
      margin-top: 130px;
      width: 700px;
      margin-left: auto;
      margin-right: auto;
      max-width: 100vw;
      padding: 8px 0 0 0;
      box-sizing: border-box;
    }

    .main-wrapper > .container {
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      padding: 0;
    }

    .footer-bar {
      margin-top: 40px;
      margin-bottom: 32px;
      border-radius: 16px;
      border: 2px solid #3b82f6;
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.25), 0 2px 10px rgba(0,0,0,0.3);
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
      transition: opacity 0.5s ease;
      opacity: 1;
      pointer-events: auto;
    }

    #loadingScreen.hidden {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .loading-spinner {
      width: 100%;
      max-width: 700px;
      background: #1e293b;
      border-radius: 0;
      padding: 16px;
      box-shadow: none;
      position: relative;
      z-index: 100;
      border: 1px solid #334155;
      margin-left: auto;
      margin-right: auto;
      overflow: visible;
      height: auto;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      color: #cbd5e1;
      font-size: 32px;
      font-style: italic;
      font-weight: bold;
      margin: 20px 0 0 0;
      padding: 0;
    }

    .container {
      width: 100%;
      max-width: 700px;
      background: #0f172a;
      border-radius: 0;
      padding: 12px 12px;
      box-shadow: none;
      position: relative;
      z-index: 100;
      border: none;
      margin: 0 auto;
    }

    #activationStatus {
      display: none;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 20px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .section {
      background: #1e293b;
      padding: 14px;
      border-radius: 8px;
      margin-bottom: 10px;
      border: 1px solid #334155;
    }

    .section-title {
      font-weight: 700;
      margin-bottom: 8px;
      color: #cbd5e1;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input[type="text"],
    input[type="color"],
    select {
      width: 100%;
      padding: 12px;
      border: 1px solid #334155;
      border-radius: 12px;
      background: #1e293b;
      color: #e2e8f0;
      margin-bottom: 8px;
      font-size: 14px;
      font-family: inherit;
    }
    
    select option {
      font-family: inherit;
    }

    input[type="color"] {
      padding: 4px;
      height: 32px;
      cursor: pointer;
      border-radius: 8px;
    }

    select {
      cursor: pointer;
    }

    input[type="text"]::placeholder {
      color: #64748b;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .color-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .color-row > div {
      display: flex;
      flex-direction: column;
    }

    .color-row label {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #cbd5e1;
    }

    .color-row input[type="color"] {
      margin-bottom: 0;
      height: 32px;
      cursor: pointer;
    }

    button {
      padding: 10px 14px;
      border: none;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
      font-size: 13px;
      font-family: inherit;
      transition: all 0.2s;
      width: 100%;
      margin-top: 8px;
      pointer-events: auto;
      touch-action: manipulation;
      min-height: 38px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    button.primary {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      margin-top: 0 !important;
      padding-top: 0 !important;
    }

    button.primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(59, 130, 246, 0.25);
    }

    button.primary:active {
      transform: translateY(0);
    }

    button.secondary {
      background: linear-gradient(135deg, #475569, #334155);
      color: white;
      margin-top: 0;
      border: 1px solid #64748b;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    button.secondary:hover:not(:disabled) {
      background: linear-gradient(135deg, #64748b, #475569);
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
    }

    button.secondary:active:not(:disabled) {
      transform: translateY(0);
    }

    button.secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    button.ghost {
      background: transparent;
      color: #cbd5e1;
      border: 1px solid #475569;
      margin-top: 0;
      transition: all 0.2s;
    }

    button.ghost:hover {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.05));
      color: #e2e8f0;
      border-color: #3b82f6;
      box-shadow: 0 2px 6px rgba(59, 130, 246, 0.15);
      transform: translateY(-1px);
    }

    button.ghost:active {
      transform: translateY(0);
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 8px;
    }

    .button-group.full {
      grid-template-columns: 1fr;
    }

    .button-row-wide {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
      align-items: stretch;
      max-width: 100%;
    }

    #qrPreview {
      text-align: center;
      padding: 20px;
      background: #0f172a;
      border-radius: 8px;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    #qrPreview canvas {
      max-width: 100%;
      height: auto;
      border-radius: 6px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

    #qrPreview p {
      color: #64748b;
      font-size: 14px;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 5000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      overflow: auto;
      pointer-events: auto;
    }
    
    .modal > * {
      pointer-events: auto;
    }

    .modal.active {
      display: flex !important;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: #1e293b;
      padding: 24px;
      border-radius: 12px;
      max-width: 600px;
      width: 100%;
      max-width: 700px;
      margin-bottom: 4px;
      display: flex;
      flex-direction: column;
      height: auto;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 1px solid #334155;
    }
    
    .modal-content button {
      pointer-events: auto;
      touch-action: manipulation;
      -webkit-user-select: none;
      user-select: none;
    }
    
    .modal-content input {
      pointer-events: auto;
      touch-action: manipulation;
    }

    .modal-content h2 {
      margin-bottom: 16px;
      color: #10b981;
      font-size: 22px;
      text-align: center;
    }

    #helpContent,
    #aboutContent {
      line-height: 1.8;
      color: #cbd5e1;
      font-size: 14px;
      text-align: left;
    }

    #helpContent p,
    #aboutContent p {
      margin-bottom: 12px;
      color: #e2e8f0;
    }

    #helpContent a,
    #aboutContent a {
      color: #3b82f6;
      text-decoration: none;
      word-break: break-word;
    }

    #helpContent a:hover,
    #aboutContent a:hover {
      color: #60a5fa;
      text-decoration: underline;
    }

    #helpContent hr,
    #aboutContent hr {
      margin: 16px 0;
      border: none;
      border-top: 1px solid #475569;
    }

    .modal-content p {
      line-height: 1.8;
      margin-bottom: 12px;
      font-size: 14px;
      color: #cbd5e1;
    }

    .modal-content a {
      color: #3b82f6;
      text-decoration: none;
      word-break: break-word;
    }

    .modal-content a:hover {
      text-decoration: underline;
      color: #60a5fa;
    }

    .close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      font-size: 14px !important;
      font-weight: 600;
      cursor: pointer;
      color: #ffffff;
      background: #ef4444;
      border: none;
      padding: 8px 16px !important;
      width: auto !important;
      min-width: 60px !important;
      max-width: 80px !important;
      height: 34px !important;
      min-height: 34px !important;
      line-height: 1;
      text-align: center;
      border-radius: 20px;
      transition: all 0.2s;
      pointer-events: auto !important;
      z-index: 5002;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .close-btn:hover {
      background: #dc2626;
      transform: none;
    }
    
    .close-btn:active {
      background: #b91c1c;
      transform: none;
    }

    .logo-preview {
      margin-top: 8px;
      padding: 8px;
      background: #0f172a;
      border-radius: 12px;
      text-align: center;
      max-height: 80px;
    }

    .logo-preview img {
      max-width: 100%;
      max-height: 80px;
      border-radius: 8px;
    }

    .logo-preview p {
      color: #64748b;
      font-size: 12px;
      margin-top: 4px;
    }

    @media (max-width: 768px) {
      .header-bar {
        width: calc(100vw - 16px);
        max-width: none;
        height: auto;
        min-height: 90px;
        padding: 8px 10px;
      }
      
      .header-bar h1 {
        font-size: 24px;
        letter-spacing: 1px;
      }
      
      .header-bar .button-row {
        flex-wrap: wrap;
        gap: 6px;
      }
      
      .header-bar .button-row button {
        font-size: 11px;
        padding: 8px 10px;
        min-width: auto;
        flex: 1 1 auto;
      }
      
      .container {
        display: block !important;
        width: calc(100vw - 16px);
        max-width: none;
        padding: 12px;
        margin: 8px auto !important;
      }
      
      .main-wrapper {
        width: 100%;
        max-width: none;
        padding: 0 8px;
        margin-top: 140px;
      }
      
      #qrPreview {
        grid-column: 1;
        grid-row: auto;
        margin-top: 20px;
      }
      
      .footer-bar {
        width: calc(100vw - 16px);
        max-width: none;
      }
      
      h1 { font-size: 18px; }
      button { font-size: 12px; padding: 10px 12px; min-height: 36px; }
      input, select { font-size: 16px; padding: 10px; }
    }

    @media (max-width: 480px) {
      body { padding: 0; }
      
      .header-bar {
        width: calc(100vw - 12px);
        min-height: 85px;
        padding: 6px 8px;
        top: 6px;
      }
      
      .header-bar h1 {
        font-size: 20px;
        padding: 10px 0 6px 0;
      }
      
      .header-bar .button-row button {
        font-size: 10px;
        padding: 6px 8px;
      }
      
      .main-wrapper {
        margin-top: 130px;
        padding: 0 6px;
      }
      
      .container { 
        width: calc(100vw - 12px); 
        max-width: none;
        margin: 6px auto; 
        padding: 10px;
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .footer-bar {
        width: calc(100vw - 12px);
        max-width: none;
        margin-top: 30px;
        padding: 20px 12px !important;
        font-size: 12px !important;
      }
      
      h1 { font-size: 16px; }
      .button-group { grid-template-columns: 1fr 1fr; }
      button { font-size: 11px; padding: 8px 6px; min-height: 36px; }
      input, select { font-size: 16px; padding: 12px; }
      .section { padding: 12px; overflow: visible; height: auto; }
      
      #qrPreview {
        grid-column: 1;
        grid-row: auto;
        min-height: 200px;
      }
      
      .modal-content {
        width: 95vw !important;
        max-width: 95vw !important;
        margin: 20px auto !important;
        padding: 16px !important;
      }
      
      .modal-content button {
        padding: 12px !important;
        font-size: 13px !important;
        min-height: 44px !important;
        width: 100% !important;
      }
    }

    @media (min-width: 769px) {
      .container {
        grid-template-columns: 1fr 1fr;
        max-width: 1400px;
      }
      
      button {
        min-height: 40px;
        font-size: 14px;
        padding: 12px 18px;
      }
      
      input[type="text"],
      input[type="color"],
      select {
        font-size: 14px;
        padding: 10px 12px;
      }
      
      #qrPreview {
        min-height: 500px;
        grid-column: 2;
        grid-row: 2;
      }
    }
  </style>
</head>
<body onload="initializeWelcome()">
  <!-- Update Notification Banner -->
  <div id="updateBanner" style="display: none; background: linear-gradient(135deg, #f59e0b, #d97706); padding: 12px 16px; text-align: center; color: white; font-weight: 600; font-size: 13px; border-bottom: 1px solid #b45309; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
    ğŸ”„ New version available! <button id="updateNowBtn" style="background: white; color: #d97706; border: none; padding: 4px 12px; border-radius: 3px; font-weight: 700; cursor: pointer; margin-left: 8px; font-size: 12px;">Update Now</button>
  </div>

  <!-- Loading Screen -->
  <div id="loadingScreen">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading KMQR Generator...</div>
  </div>

  <!-- Welcome Choice Screen -->
  <div id="welcomeModal" style="display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; z-index: 9999; padding: 40px 20px; text-align: center; overflow-y: auto;">
    <h2 id="welcomeTitle" style="color: #3b82f6; margin: 0 0 12px 0; font-size: 28px;"></h2>
    <p id="welcomeSubtitle" style="color: #cbd5e1; margin: 0 0 30px 0; font-size: 14px;"></p>
    <button id="btnEnterLicense" type="button" onclick="try { handleBtnEnterLicense(); } catch(e) { console.error('Error:', e); alert('Error: ' + e.message); }" style="display: block; width: 95%; max-width: 350px; margin: 20px auto; padding: 24px; background: #10b981; color: white; border: 2px solid #10b981; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 18px; min-height: 60px; position: relative; z-index: 10000; pointer-events: auto;"></button>
    <button id="btnSkipTrial" type="button" onclick="try { handleBtnSkipTrial(); } catch(e) { console.error('Error:', e); alert('Error: ' + e.message); }" style="display: block; width: 95%; max-width: 350px; margin: 15px auto; padding: 16px; background: transparent; color: #60a5fa; border: 2px solid #60a5fa; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; min-height: 50px; position: relative; z-index: 10000; pointer-events: auto;"></button>
    <p id="trialModeInfo" style="color: #64748b; font-size: 12px; margin-top: 20px;"></p>
  </div>

  <!-- License Code Activation Modal -->
  <div id="licenseModal" class="modal">
    <div class="modal-content" style="max-width: 450px;">
      <h2 id="licenseModalTitle" style="color: #10b981; text-align: center; margin-bottom: 20px;">ğŸ”“ á”á‰áŸ’á…á¼á›á›áŸáá€á¼áŠ</h2>
      <div style="background: #0f172a; padding: 16px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #334155;">
        <div id="deviceIdInfo" style="margin-bottom: 10px; text-align: center;"></div>
        <p id="licenseInstructions" style="font-size: 13px; color: #cbd5e1; margin-bottom: 12px;"><strong>á”á‰áŸ’á…á¼á›á›áŸáá€á¼áŠášá”áŸáŸ‹á¢áŸ’á“á€áá¶á„á€áŸ’ášáŸ„á˜áŠá¾á˜áŸ’á”á¸áŠáŸ„áŸ‡áŸáŸ„á˜á»áá„á¶ášá–áŸá‰á›áŸá‰áŸ–</strong></p>
        <input type="text" id="licenseCodeInput" placeholder="á”á‰áŸ’á…á¼á›á›áŸáá€á¼áŠášá”áŸáŸ‹á¢áŸ’á“á€á“áŸ…á‘á¸á“áŸáŸ‡..." style="width: 100%; padding: 12px; border: 1px solid #475569; border-radius: 12px; background: #1e293b; color: #e2e8f0; font-size: 14px; margin-bottom: 12px; font-family: monospace; touch-action: manipulation; pointer-events: auto;">
        <p id="licenseContactInfo" style="font-size: 12px; color: #94a3b8; line-height: 1.6;">ğŸ“§ á˜á·á“á˜á¶á“á›áŸáá€á¼áŠá‘áŸ?<br>á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„áŸ– <strong><a href="mailto:my.khem.mathst@gmail.com" style="color:#3b82f6;">my.khem.mathst@gmail.com</a></strong><br>ğŸ“± á‘á¼ášáŸáŸá–áŸ’á‘áŸ– <strong><a href="tel:+85566931319" style="color:#3b82f6;">+855 66/99 931319</a></strong><br>ğŸ’¬ TelegramáŸ– <strong><a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></strong></p>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <button id="btnActivateLicense" type="button" onclick="try { handleBtnActivateLicense(); } catch(e) { console.error('Error:', e); alert('Error: ' + e.message); }" style="padding: 14px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 14px; min-height: 50px; width: 100%; pointer-events: auto; touch-action: manipulation; -webkit-user-select: none; user-select: none;">âœ… á’áŸ’áœá¾á±áŸ’á™áŸá€á˜áŸ’á˜</button>
        <button id="btnCancelLicense" type="button" onclick="try { handleBtnCancelLicense(); } catch(e) { console.error('Error:', e); alert('Error: ' + e.message); }" style="padding: 14px; background: #64748b; color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 14px; min-height: 50px; width: 100%; pointer-events: auto; touch-action: manipulation; -webkit-user-select: none; user-select: none;">á”áŸ„áŸ‡á”á„áŸ‹</button>
      </div>
    </div>
  </div>

  <!-- Header with Title and Buttons -->
  <div class="header-bar">
    <div style="display: flex; flex-direction: column; align-items: center; gap: 0; width: 100%; max-width: 700px; margin-left: auto; margin-right: auto;">
      <div style="width: 100%; display: flex; justify-content: center; align-items: center; padding: 0 8px;">
        <h1 id="title" style="display: flex; justify-content: center; align-items: center; margin: 0; font-size: 26px; font-family: 'Hanuman', 'Segoe UI', Arial, sans-serif; font-style: italic; background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; white-space: nowrap; font-weight: 900; letter-spacing: 1px; line-height: 1.1; text-align: center;">KMQR Generator</h1>
      </div>
      <div class="button-row" style="width: 100%; display: flex; flex-direction: row; gap: 8px; justify-content: center; margin-top: 10px; margin-bottom: 8px; flex-wrap: nowrap; overflow-x: auto;">
        <button id="btnHelp2" style="background: #475569; color: #e2e8f0; border: 1px solid #64748b; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 700; cursor: pointer; white-space: nowrap; transition: all 0.2s; min-height: 36px; display: flex; align-items: center; justify-content: center; line-height: 1;" onclick="showHelpModal();">â“ <span id="btnHelp2Text">Help</span></button>
        <button id="btnAbout2" style="background: #475569; color: #e2e8f0; border: 1px solid #64748b; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 700; cursor: pointer; white-space: nowrap; transition: all 0.2s; min-height: 36px; display: flex; align-items: center; justify-content: center; line-height: 1;" onclick="showAboutModal();">About</button>
        <button id="updateCheckBtn" onclick="performUpdate();" style="background: #475569; color: #e2e8f0; border: 1px solid #64748b; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 700; cursor: pointer; white-space: nowrap; transition: all 0.2s; min-height: 36px; display: flex; align-items: center; justify-content: center; line-height: 1;">ğŸ”„ Update</button>
        <button id="langToggle" style="background: #475569; color: #e2e8f0; border: 1px solid #64748b; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 700; cursor: pointer; white-space: nowrap; transition: all 0.2s; min-height: 36px; display: flex; align-items: center; justify-content: center; line-height: 1;">ğŸŒ English</button>
      </div>
    </div>
  </div>

  <!-- Update Info Modal -->
  <div id="updateInfoModal" class="modal">
    <div class="modal-content" style="max-width: 380px; text-align: center;">
      <button class="close-btn" id="updateCloseBtn" onclick="document.getElementById('updateInfoModal').classList.remove('active'); document.getElementById('updateInfoModal').style.display = 'none';">Close</button>
      <h2 style="color: #f59e0b; font-size: 22px; font-weight: 700; margin: 0 0 18px 0;">Update Info</h2>
      <div id="updateInfoContent" style="font-size:16px;line-height:1.7;color:#e2e8f0;"></div>
    </div>
  </div>

  <div class="main-wrapper">
    <div class="container">
      <div class="section">
        <div class="section-title" id="textLabel">á¢ááŸ’áá”á‘ á¬ URL</div>
        <input id="qrText" type="text" placeholder="á”á‰áŸ’á…á¼á›á¢ááŸ’áá”á‘, URL, á¬á—á¶áŸá¶ááŸ’á˜áŸ‚ášâ€¦" style="margin-bottom: 0;" />
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 14px;">
          <div>
            <label id="sizeLabel" style="font-size: 12px; font-weight: 600; color: #cbd5e1; display: block; margin-bottom: 4px;">á‘áŸ†á áŸ†</label>
            <select id="qrSize" style="margin-bottom: 0;">
              <option value="200">200</option>
              <option value="256">256</option>
              <option value="320">320</option>
              <option value="400">400</option>
            </select>
          </div>
          <div>
            <label id="ecLabel" style="font-size: 12px; font-weight: 600; color: #cbd5e1; display: block; margin-bottom: 4px;">á€á˜áŸ’ášá·áá€áŸ‚á€áŸ†á á»áŸ</label>
            <select id="qrEC" style="margin-bottom: 0;">
              <option value="L" id="ecLow">á‘á¶á”</option>
              <option value="M" selected id="ecMedium">á˜á’áŸ’á™á˜</option>
              <option value="Q" id="ecQuartile">ááŸ’á–áŸáŸ‹</option>
              <option value="H" id="ecHigh">ááŸ’á–áŸáŸ‹á”áŸ†á•á»á</option>
            </select>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 14px;">
          <div>
            <label id="dpiLabel" style="font-size: 12px; font-weight: 600; color: #cbd5e1; display: block; margin-bottom: 4px;">á‚á»áá—á¶á– (DPI)</label>
            <select id="dpiScale" style="margin-bottom: 0;">
              <option value="1">1Ã—</option>
              <option value="2" selected>2Ã—</option>
              <option value="3">3Ã—</option>
            </select>
          </div>
          <div>
            <label id="roundLabel" style="font-size: 12px; font-weight: 600; color: #cbd5e1; display: block; margin-bottom: 4px;">ášá¼á”áŸá‰áŸ’á‰á¶á˜á¼á›</label>
            <select id="logoRound" style="margin-bottom: 0;">
              <option value="no" id="no">á‘áŸ</option>
              <option value="yes" selected id="yes">á”á¶á‘/á…á¶áŸ</option>
            </select>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 14px;">
          <div>
            <label id="fgLabel" style="font-size: 12px; font-weight: 600; color: #cbd5e1; display: block; margin-bottom: 4px;">á–ááŸŒá˜á»á</label>
            <input id="qrFG" type="color" value="#000000" style="margin-bottom: 0;" />
          </div>
          <div>
            <label id="bgLabel" style="font-size: 12px; font-weight: 600; color: #cbd5e1; display: block; margin-bottom: 4px;">á–ááŸŒáá¶á„á€áŸ’ášáŸ„á™</label>
            <input id="qrBG" type="color" value="#ffffff" style="margin-bottom: 0;" />
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr; gap: 12px; margin-top: 14px;">
          <div>
            <label id="logoBgLabel" style="font-size: 12px; font-weight: 600; color: #cbd5e1; display: block; margin-bottom: 4px;">á–ááŸŒáá¶á„á€áŸ’ášáŸ„á™ášá¼á”áŸá‰áŸ’á‰á¶</label>
            <input id="logoBg" type="color" value="#ffffff" style="margin-bottom: 0;" />
          </div>
        </div>
        
        <div style="margin-top: 14px;">
          <label id="captionLabel" style="font-size: 12px; font-weight: 600; color: #cbd5e1; display: block; margin-bottom: 4px;">á¢ááŸ’áá”á‘á›á¾á€á¼áŠ</label>
          <input id="overlayText" type="text" placeholder="á§. ááŸ‚á˜â€‹ á˜á¸" style="margin-bottom: 0;" />
        </div>
        
        <div style="margin-top: 14px;">
          <label id="logoLabel" style="font-size: 12px; font-weight: 600; color: #cbd5e1; display: block; margin-bottom: 4px;">á‡áŸ’ášá¾áŸášá¾áŸášá¼á”á—á¶á–</label>
          <div style="display: flex; gap: 8px; align-items: stretch;">
            <button id="logoUploadBtn" class="secondary" style="margin-top: 0; margin-bottom: 0; flex: 1; height: 38px; min-height: 38px; max-height: 38px;" onclick="document.getElementById('logoUpload').click();">ğŸ“ á‡áŸ’ášá¾áŸášá¼á”á—á¶á–</button>
            <button id="activateBtn" class="secondary" style="background: linear-gradient(135deg, #10b981, #059669); border: 1px solid #10b981; margin-top: 0; margin-bottom: 0; flex: 1; height: 38px; min-height: 38px; max-height: 38px;" onclick="document.getElementById('helpModal').classList.remove('active'); document.getElementById('helpModal').style.display = 'none'; document.getElementById('aboutModal').classList.remove('active'); document.getElementById('aboutModal').style.display = 'none'; document.getElementById('licenseModal').classList.add('active'); document.getElementById('licenseModal').style.display = 'flex';">ğŸ”“ Activate</button>
          </div>
          <input id="logoUpload" type="file" accept="image/*" style="display: none;" onchange="handleLogoUpload(this);" />
          <div id="logoPreview" class="logo-preview" style="display: none;"></div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
          <button class="primary" id="btnGenerate" style="min-height: 44px; height: 44px; line-height: 1; padding: 0 12px;">âœ¨ á”á„áŸ’á€á¾áá€á¼áŠ QR</button>
          <button class="ghost" id="btnClear" style="min-height: 44px; height: 44px; line-height: 1; padding: 0 12px;">ğŸ—‘ï¸ áŸá˜áŸ’á¢á¶á</button>
        </div>
      </div>
    </div>

    <div class="container" style="margin-top: 8px;">
      <div class="section">
        <div id="qrPreview"><p id="previewHint">á”á‰áŸ’á…á¼á›á¢ááŸ’áá”á‘ á á¾á™á…á»á…á”á„áŸ’á€á¾á</p></div>
      </div>
      <div class="button-row-wide">
        <button class="secondary" id="btnDownload" disabled onclick="var dm = document.getElementById('downloadMenu'); var sm = document.getElementById('shareMenu'); sm.style.display = 'none'; dm.style.display = dm.style.display === 'block' ? 'none' : 'block';">ğŸ“¥ á‘á¶á‰á™á€</button>
        <button class="secondary" id="btnShare" disabled onclick="var sm = document.getElementById('shareMenu'); var dm = document.getElementById('downloadMenu'); dm.style.display = 'none'; sm.style.display = sm.style.display === 'block' ? 'none' : 'block';">ğŸ“¤ á…áŸ‚á€ášáŸ†á›áŸ‚á€</button>
      </div>
      <div id="downloadMenu" style="display: none; background: #0f172a; padding: 12px; border-radius: 6px; margin: 20px auto; max-width: 1400px; border: 1px solid #334155; margin-left: 8px; margin-right: 8px;">
        <p id="downloadFormatLabel" style="font-size: 12px; color: #cbd5e1; margin-bottom: 8px; font-weight: 600;">á‘á˜áŸ’ášá„áŸ‹á‘á¶á‰á™á€áŸ–</p>
        <div class="button-group">
          <button class="ghost" id="downloadPNG">ğŸ“„ PNG</button>
          <button class="ghost" id="downloadJPG">ğŸ“„ JPG</button>
          <button class="ghost" id="downloadPDF">ğŸ“„ PDF</button>
        </div>
      </div>
      <div id="shareMenu" style="display: none; background: #0f172a; padding: 12px; border-radius: 6px; margin: 20px auto; max-width: 1400px; border: 1px solid #334155; margin-left: 8px; margin-right: 8px; position: relative; clear: both;">
        <p id="shareToLabel" style="font-size: 12px; color: #cbd5e1; margin-bottom: 8px; font-weight: 600;">á…áŸ‚á€ášáŸ†á›áŸ‚á€á‘áŸ…áŸ–</p>
        <div class="button-group full">
          <button class="ghost" id="shareWhatsApp" onclick="shareToSocial('whatsapp');">ğŸ“± WhatsApp</button>
          <button class="ghost" id="shareFacebook" onclick="shareToSocial('facebook');">ğŸ‘ Facebook</button>
          <button class="ghost" id="shareTwitter" onclick="shareToSocial('twitter');">ğ• Twitter</button>
          <button class="ghost" id="shareTelegram" onclick="shareToSocial('telegram');">ğŸ’¬ Telegram</button>
        </div>
        <div class="button-group full" style="margin-top: 8px;">
          <button class="ghost" id="shareCopy" onclick="shareToSocial('copy');">ğŸ“‹ Copy Link</button>
          <button class="ghost" id="shareEmail" onclick="shareToSocial('email');">ğŸ“§ Email</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div id="helpModal" class="modal">
    <div class="modal-content" style="max-width: 420px;">
      <button class="close-btn" id="helpCloseBtn" onclick="document.getElementById('helpModal').classList.remove('active'); document.getElementById('helpModal').style.display = 'none';">Close</button>
      <h2 id="helpTitle" style="color: #22d3a9; font-size: 32px; font-weight: 700; margin: 0 0 18px 0; text-align: center;">á‡áŸ†á“á½á™ - KMQR Generator Pro</h2>
      <div id="helpContent" style="font-size:16px;line-height:1.7;color:#e2e8f0;"></div>
    </div>
  </div>

  <!-- About Modal -->
  <div id="aboutModal" class="modal">
    <div class="modal-content" style="max-width: 420px;">
      <button class="close-btn" id="aboutCloseBtn" onclick="document.getElementById('aboutModal').classList.remove('active'); document.getElementById('aboutModal').style.display = 'none';">Close</button>
      <h2 id="aboutTitle" style="color: #3b82f6; font-size: 28px; font-weight: 700; margin: 0 0 12px 0; text-align: center;">á¢áŸ†á–á¸ KMQR Generator Pro</h2>
      <div id="aboutContent" style="font-size:16px;line-height:1.7;color:#e2e8f0;"></div>
    </div>
  </div>
  
  <!-- Footer Contact Info -->
  <div class="footer-bar" style="padding:32px 20px 32px 20px;color:#cbd5e1;text-align:center;font-size:14px;background:#0f172a;">
    <div style="line-height:2;">
      <div style="margin-bottom:8px;">
        <span><span id="footerPhoneLabel">Phone:</span> <a href="tel:+8556699313199" style="color:#3b82f6;">+855 66/99 931319</a></span> | 
        <span><span id="footerTelegramLabel">Telegram:</span> <a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></span>
      </div>
      <div style="margin-bottom:8px;">
        <span><span id="footerFacebookLabel">Facebook:</span> <a href="https://facebook.com/KMLOL" target="_blank" style="color:#3b82f6;">facebook.com/KMLOL</a></span>
      </div>
      <div>
        <span><span id="footerCopyrightLabel">Copyright:</span> Â© 2026 <span id="footerAuthorName">Khem My</span>. <span id="footerRightsText">All rights reserved.</span></span>
      </div>
    </div>
  </div>

  <script>
    const KMQR_VERSION = '1.0.8';
    let currentLang = localStorage.getItem('kmqr_lang') || 'km';
    let exportCanvas = null;
    let logoImage = null;

    // Initialize version check
    const versionKey = 'kmqr_version_loaded';
    const storedVersion = localStorage.getItem(versionKey);
    
    if (storedVersion !== KMQR_VERSION) {
      const activationState = localStorage.getItem('kmqr_app_activated');
      const licenseCode = localStorage.getItem('kmqr_license_code');
      localStorage.clear();
      if (activationState) localStorage.setItem('kmqr_app_activated', activationState);
      if (licenseCode) localStorage.setItem('kmqr_license_code', licenseCode);
      localStorage.setItem(versionKey, KMQR_VERSION);
      localStorage.setItem('kmqr_welcome_shown', 'true');
    }

    // Handler functions
    window.handleBtnEnterLicense = function() {
      document.getElementById('welcomeModal').style.display = 'none';
      document.getElementById('licenseModal').classList.add('active');
      document.getElementById('licenseModal').style.display = 'flex';
    };
    
    window.handleBtnSkipTrial = function() {
      localStorage.setItem('kmqr_welcome_shown', 'true');
      localStorage.setItem('kmqr_app_activated', 'false');
      document.getElementById('welcomeModal').style.display = 'none';
      document.querySelectorAll('.container').forEach(el => el.style.display = 'block');
      document.querySelectorAll('.main-wrapper').forEach(el => el.style.display = 'block');
      updateActivationStatus();
    };

    function getDeviceId() {
      let deviceId = localStorage.getItem('kmqr_device_id');
      if (!deviceId) {
        deviceId = 'KMQR-' + ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
          (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
        );
        localStorage.setItem('kmqr_device_id', deviceId);
      }
      return deviceId;
    }
    
    // License code generation algorithm
    // Secret key for generating license codes
    const KMQR_SECRET = 'KM2026QR';
    
    function generateLicenseCode(deviceId) {
      // Extract the UUID part from device ID (after KMQR-)
      const uuid = deviceId.replace('KMQR-', '');
      
      // Create a hash-like code from device ID + secret
      let hash = 0;
      const combined = uuid + KMQR_SECRET;
      for (let i = 0; i < combined.length; i++) {
        const char = combined.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convert to 32bit integer
      }
      
      // Make hash positive
      hash = Math.abs(hash);
      
      // Convert to base36 and format as license code
      const code1 = (hash % 1000000).toString(36).toUpperCase().padStart(4, '0').substring(0, 4);
      const code2 = ((hash >> 8) % 1000000).toString(36).toUpperCase().padStart(4, '0').substring(0, 4);
      const code3 = ((hash >> 16) % 1000000).toString(36).toUpperCase().padStart(4, '0').substring(0, 4);
      
      return 'KMQR-' + code1 + '-' + code2 + '-' + code3;
    }
    
    function validateLicenseCode(licenseCode, deviceId) {
      // Check format first
      if (!licenseCode.startsWith('KMQR-')) {
        return false;
      }
      
      // Generate the valid code for this device
      const validCode = generateLicenseCode(deviceId);
      
      // Compare entered code with valid code (case insensitive)
      return licenseCode.toUpperCase() === validCode.toUpperCase();
    }
    
    // Developer function to generate license code for any device ID
    // Use in browser console: KMQR_generateLicense('KMQR-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx')
    window.KMQR_generateLicense = function(deviceId) {
      if (!deviceId) {
        deviceId = getDeviceId();
      }
      const code = generateLicenseCode(deviceId);
      console.log('Device ID:', deviceId);
      console.log('License Code:', code);
      return code;
    };

    function updateDeviceIdInfo() {
      const deviceIdDiv = document.getElementById('deviceIdInfo');
      if (deviceIdDiv && translations[currentLang]) {
        const t = translations[currentLang];
        const deviceId = getDeviceId();
        deviceIdDiv.innerHTML = '<span style="color:#f59e0b;font-size:13px;">' + t.deviceIdLabel + '</span><br><span id="deviceIdText" onclick="copyDeviceId()" style="font-family:monospace;font-size:15px;color:#3b82f6;cursor:pointer;padding:6px 12px;background:#1e293b;border-radius:8px;display:inline-block;margin-top:5px;border:1px solid #334155;" title="' + (currentLang === 'km' ? 'á…á»á…áŠá¾á˜áŸ’á”á¸á…á˜áŸ’á›á„' : 'Click to copy') + '">' + deviceId + ' ğŸ“‹</span>';
      }
    }

    function copyDeviceId() {
      const deviceId = getDeviceId();
      navigator.clipboard.writeText(deviceId).then(function() {
        const deviceIdText = document.getElementById('deviceIdText');
        const originalText = deviceIdText.innerHTML;
        deviceIdText.innerHTML = deviceId + ' âœ…';
        deviceIdText.style.background = '#166534';
        setTimeout(function() {
          deviceIdText.innerHTML = originalText;
          deviceIdText.style.background = '#1e293b';
        }, 1500);
      }).catch(function() {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = deviceId;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert(currentLang === 'km' ? 'á”á¶á“á…á˜áŸ’á›á„ Device ID!' : 'Device ID copied!');
      });
    }

    window.handleBtnActivateLicense = function() {
      const licenseInput = document.getElementById('licenseCodeInput');
      const licenseCode = licenseInput.value.trim();
      
      if (!licenseCode) {
        alert(translations[currentLang].alertEnterLicense);
        return;
      }
      
      const deviceId = getDeviceId();
      
      // Validate the license code against device ID
      if (!validateLicenseCode(licenseCode, deviceId)) {
        alert(translations[currentLang].alertInvalidLicense);
        return;
      }
      
      localStorage.setItem('kmqr_welcome_shown', 'true');
      localStorage.setItem('kmqr_app_activated', 'true');
      localStorage.setItem('kmqr_license_code', licenseCode);
      
      document.getElementById('licenseModal').classList.remove('active');
      document.getElementById('licenseModal').style.display = 'none';
      document.getElementById('welcomeModal').style.display = 'none';
      document.querySelectorAll('.container').forEach(el => el.style.display = 'block');
      document.querySelectorAll('.main-wrapper').forEach(el => el.style.display = 'block');
      
      licenseInput.value = '';
      updateActivationStatus();
      updateDeviceIdInfo();
    };
    
    window.handleBtnCancelLicense = function() {
      localStorage.setItem('kmqr_welcome_shown', 'true');
      localStorage.setItem('kmqr_app_activated', 'false');
      document.getElementById('licenseModal').classList.remove('active');
      document.getElementById('licenseModal').style.display = 'none';
      document.querySelectorAll('.container').forEach(el => el.style.display = 'block');
      document.querySelectorAll('.main-wrapper').forEach(el => el.style.display = 'block');
      document.getElementById('licenseCodeInput').value = '';
      updateActivationStatus();
      updateDeviceIdInfo();
    };

    function handleLogoUpload(input) {
      if (input.files && input.files[0]) {
        const file = input.files[0];
        const fileName = file.name;
        const reader = new FileReader();
        reader.onload = (event) => {
          logoImage = new Image();
          logoImage.onload = () => {
            document.getElementById('logoPreview').innerHTML = '<p style="margin:0;color:#10b981;font-size:13px;">ğŸ“ ' + fileName + '</p>';
            document.getElementById('logoPreview').style.display = 'block';
          };
          logoImage.onerror = () => {
            alert(translations[currentLang].alertLogoFailed);
            logoImage = null;
            document.getElementById('logoPreview').style.display = 'none';
            input.value = '';
          };
          logoImage.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    function initializeWelcome() {
      const hasSeenWelcome = localStorage.getItem('kmqr_welcome_shown') === 'true';
      const welcomeModal = document.getElementById('welcomeModal');
      
      if (welcomeModal) {
        if (hasSeenWelcome) {
          welcomeModal.style.display = 'none';
          document.querySelectorAll('.container').forEach(el => el.style.display = 'block');
          document.querySelectorAll('.main-wrapper').forEach(el => el.style.display = 'block');
          updateActivationStatus();
        } else {
          welcomeModal.style.display = 'block';
          document.querySelectorAll('.container').forEach(el => el.style.display = 'none');
          document.querySelectorAll('.main-wrapper').forEach(el => el.style.display = 'none');
        }
      }
      
      setTimeout(() => {
        const loadingScreen = document.getElementById('loadingScreen');
        if (loadingScreen) {
          loadingScreen.classList.add('hidden');
          loadingScreen.style.display = 'none';
        }
      }, 500);
    }

    function checkForUpdates() {
      const lastChecked = localStorage.getItem('kmqr_last_update_check');
      const now = Date.now();
      
      if (!lastChecked || (now - parseInt(lastChecked)) > 6 * 60 * 60 * 1000) {
        localStorage.setItem('kmqr_last_update_check', now.toString());
      }
    }

    function performUpdate() {
      const updateInfoModal = document.getElementById('updateInfoModal');
      const updateInfoContent = document.getElementById('updateInfoContent');
      
      if (currentLang === 'km') {
        document.querySelector('#updateInfoModal h2').textContent = 'á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“á—á¶á–á€á˜áŸ’á˜áœá·á’á¸';
        updateInfoContent.innerHTML = '<div style="font-size:18px;font-weight:700;color:#f59e0b;">á‡áŸ†á“á¶á“áŸ‹ áŸ¡.áŸ .áŸ¨</div><div style="margin-bottom:8px;">áŸá˜áŸ’ášá¶á”áŸ‹á’áŸ’áœá¾á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“á—á¶á– áŸá¼á˜á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á¢áŸ’á“á€á¢á—á·áœáŒáŸ’áá“áŸ</div><hr><div style="font-size:13px;color:#94a3b8;">ğŸ“§ <a href="mailto:my.khem.mathst@gmail.com" style="color:#3b82f6;">my.khem.mathst@gmail.com</a><br>ğŸ“± <a href="tel:+85566931319" style="color:#3b82f6;">+855 66/99 931319</a><br>ğŸ’¬ Telegram: <a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></div>';
      } else {
        document.querySelector('#updateInfoModal h2').textContent = 'Update Info';
        updateInfoContent.innerHTML = '<div style="font-size:18px;font-weight:700;color:#f59e0b;">Version 1.0.8</div><div style="margin-bottom:8px;">For update, please contact developer</div><hr><div style="font-size:13px;color:#94a3b8;">ğŸ“§ <a href="mailto:my.khem.mathst@gmail.com" style="color:#3b82f6;">my.khem.mathst@gmail.com</a><br>ğŸ“± <a href="tel:+85566931319" style="color:#3b82f6;">+855 66/99 931319</a><br>ğŸ’¬ Telegram: <a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></div>';
      }
      
      updateInfoModal.classList.add('active');
      updateInfoModal.style.display = 'flex';
    }

    function showHelpModal() {
      document.getElementById('aboutModal').classList.remove('active');
      document.getElementById('aboutModal').style.display = 'none';
      document.getElementById('licenseModal').classList.remove('active');
      document.getElementById('licenseModal').style.display = 'none';
      
      const helpContent = document.getElementById('helpContent');
      const t = translations[currentLang];
      
      if (currentLang === 'km') {
        helpContent.innerHTML = '<p><strong>ğŸ¯ ášá”áŸ€á”á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹áŸ–</strong></p><p>áŸ¡. á”á‰áŸ’á…á¼á›á¢ááŸ’áá”á‘ á¬ URL áŠáŸ‚á›á¢áŸ’á“á€á…á„áŸ‹á”á„áŸ’á€á¾á QR</p><p>áŸ¢. á‡áŸ’ášá¾áŸášá¾áŸá‘áŸ†á áŸ† á“á·á„á‚á»áá—á¶á–</p><p>áŸ£. á‡áŸ’ášá¾áŸášá¾áŸá–ááŸŒá˜á»á á“á·á„á–ááŸŒáá¶á„á€áŸ’ášáŸ„á™</p><p>áŸ¤. á”á“áŸ’ááŸ‚á˜ášá¼á”áŸá‰áŸ’á‰á¶ (á‡á˜áŸ’ášá¾áŸ)</p><p>áŸ¥. á…á»á…á”áŸŠá¼áá»á„ "á”á„áŸ’á€á¾áá€á¼áŠ QR"</p><p>áŸ¦. á‘á¶á‰á™á€ á¬á…áŸ‚á€ášáŸ†á›áŸ‚á€á€á¼áŠ QR ášá”áŸáŸ‹á¢áŸ’á“á€</p><hr><p><strong>ğŸ“ á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„áŸ–</strong></p><p>ğŸ“§ <a href="mailto:my.khem.mathst@gmail.com" style="color:#3b82f6;">my.khem.mathst@gmail.com</a><br>ğŸ“± <a href="tel:+85566931319" style="color:#3b82f6;">+855 66/99 931319</a><br>ğŸ’¬ Telegram: <a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></p>';
      } else {
        helpContent.innerHTML = '<p><strong>ğŸ¯ How to Use:</strong></p><p>1. Enter text or URL you want to create QR for</p><p>2. Select size and quality</p><p>3. Choose foreground and background colors</p><p>4. Add logo (optional)</p><p>5. Click "Generate QR" button</p><p>6. Download or share your QR code</p><hr><p><strong>ğŸ“ Contact:</strong></p><p>ğŸ“§ <a href="mailto:my.khem.mathst@gmail.com" style="color:#3b82f6;">my.khem.mathst@gmail.com</a><br>ğŸ“± <a href="tel:+85566931319" style="color:#3b82f6;">+855 66/99 931319</a><br>ğŸ’¬ Telegram: <a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></p>';
      }
      
      document.getElementById('helpModal').classList.add('active');
      document.getElementById('helpModal').style.display = 'flex';
    }

    function showAboutModal() {
      document.getElementById('helpModal').classList.remove('active');
      document.getElementById('helpModal').style.display = 'none';
      document.getElementById('licenseModal').classList.remove('active');
      document.getElementById('licenseModal').style.display = 'none';
      
      const aboutContent = document.getElementById('aboutContent');
      const t = translations[currentLang];
      
      if (currentLang === 'km') {
        aboutContent.innerHTML = '<div style="text-align:center;"><strong style="font-size:20px;color:#3b82f6;">á€á˜áŸ’á˜áœá·á’á¸á”á„áŸ’á€á¾á QR</strong></div><div style="margin-top:12px;text-align:center;"><span style="font-size:16px;color:#f59e0b;font-weight:700;">á‡áŸ†á“á¶á“áŸ‹ áŸ¡.áŸ .áŸ¨</span></div><hr><p><strong>ğŸ‘¨â€ğŸ’» á¢áŸ’á“á€á¢á—á·áœáŒáŸ’áá“áŸáŸ–</strong> ááŸ‚á˜ á˜á¸</p><p><em>á¢áŸ’á“á€á¢á—á·áœáŒáŸ’áá“áŸá€á˜áŸ’á˜áœá·á’á¸</em></p><hr><p><strong>ğŸ“ á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„áŸ–</strong></p><p>ğŸ“§ <a href="mailto:my.khem.mathst@gmail.com" style="color:#3b82f6;">my.khem.mathst@gmail.com</a><br>ğŸ“± <a href="tel:+85566931319" style="color:#3b82f6;">+855 66/99 931319</a><br>ğŸ’¬ Telegram: <a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></p>';
      } else {
        aboutContent.innerHTML = '<div style="text-align:center;"><strong style="font-size:20px;color:#3b82f6;">KMQR Generator</strong></div><div style="margin-top:12px;text-align:center;"><span style="font-size:16px;color:#f59e0b;font-weight:700;">Version 1.0.8</span></div><hr><p><strong>ğŸ‘¨â€ğŸ’» Developer:</strong> Khem My</p><p><em>Software Developer</em></p><hr><p><strong>ğŸ“ Contact:</strong></p><p>ğŸ“§ <a href="mailto:my.khem.mathst@gmail.com" style="color:#3b82f6;">my.khem.mathst@gmail.com</a><br>ğŸ“± <a href="tel:+85566931319" style="color:#3b82f6;">+855 66/99 931319</a><br>ğŸ’¬ Telegram: <a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></p>';
      }
      
      document.getElementById('aboutModal').classList.add('active');
      document.getElementById('aboutModal').style.display = 'flex';
    }


    const translations = {
      en: {
        title: 'KMQR Generator',
        textLabel: 'Text or URL',
        textPlaceholder: 'Enter text, URL, or any language...',
        overlayPlaceholder: 'e.g. Khem My',
        sizeLabel: 'Size',
        ecLabel: 'Error Correction',
        ecLow: 'Low', ecMedium: 'Medium', ecQuartile: 'Quartile', ecHigh: 'High',
        dpiLabel: 'Quality (DPI)', roundLabel: 'Round Logo',
        yes: 'Yes', no: 'No',
        fgLabel: 'Foreground', bgLabel: 'Background',
        logoBgLabel: 'Logo BG',
        captionLabel: 'Overlay Text',
        logoLabel: 'Choose Logo',
        logoUploadBtn: 'ğŸ“ Choose Image',
        btnGenerate: 'âœ¨ Generate QR',
        btnClear: 'Clear',
        btnDownload: 'ğŸ“¥ Download',
        btnShare: 'ğŸ“¤ Share',
        btnHelp: 'Help',
        btnAbout: 'About',
        btnUpdate: 'ğŸ”„ Update',
        previewHint: 'Enter text and click Generate',
        alertEnterText: 'Please enter text or URL',
        downloadFormatLabel: 'Download Format:',
        shareToLabel: 'Share to:',
        welcomeTitle: 'ğŸ‰ Welcome to KMQR',
        btnEnterLicense: 'âœ… Enter License',
        btnSkipTrial: 'â­ï¸ Free Trial',
        trialModeInfo: 'Trial Mode: Create and edit QR freely<br>Full License: Unlock all download formats',
        btnActivateLicense: 'âœ… Activate',
        btnCancelLicense: 'Cancel',
        btnActivate: 'ğŸ”“ Activate',
        btnDeactivate: 'ğŸ”’ Deactivate',
        alertEnterLicense: 'âŒ Please enter a license code',
        alertInvalidLicense: 'âŒ Invalid license format',
        helpTitle: 'Help - KMQR Generator',
        aboutTitle: 'About KMQR',
        version: 'Version 1.0.8',
        developerLabel: 'ğŸ‘¨â€ğŸ’» Developer:',
        developer: 'Khem My<br><em>Software Developer</em>',
        deviceIdLabel: 'Device ID:',
        licenseModalTitle: 'ğŸ”“ Enter License Code',
        licenseInstructions: '<strong>Enter your license code below to unlock full features:</strong>',
        licenseInputPlaceholder: 'Enter your license code here...',
        licenseContactInfo: 'ğŸ“§ No license code?<br>Contact: <strong><a href="mailto:my.khem.mathst@gmail.com" style="color:#3b82f6;">my.khem.mathst@gmail.com</a></strong><br>ğŸ“± Phone: <strong><a href="tel:+85566931319" style="color:#3b82f6;">+855 66/99 931319</a></strong><br>ğŸ’¬ Telegram: <strong><a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></strong>',
        alertLogoFailed: 'Failed to load logo image.',
        alertError: 'Error',
        alertDownloadLocked: 'ğŸ”’ Download locked. Click Activate!',
        alertGenerateFirst: 'Please generate a QR code first',
        alertCopied: 'Copied!',
        confirmDeactivate: 'Deactivate?',
        logoSelected: 'Logo selected',
        btnClose: 'Close',
        footerPhone: 'Phone:',
        footerTelegram: 'Telegram:',
        footerFacebook: 'Facebook:',
        footerCopyright: 'Copyright:',
        footerRights: 'All rights reserved.',
        footerAuthor: 'Khem My',
      },
      km: {
        title: 'á€á˜áŸ’á˜áœá·á’á¸á”á„áŸ’á€á¾á QR',
        textLabel: 'á¢ááŸ’áá”á‘ á¬ URL',
        sizeLabel: 'á‘áŸ†á áŸ†',
        ecLabel: 'á€á˜áŸ’ášá·áá€áŸ‚á€áŸ†á á»áŸ',
        ecLow: 'á‘á¶á”', ecMedium: 'á˜á’áŸ’á™á˜', ecQuartile: 'ááŸ’á–áŸáŸ‹', ecHigh: 'ááŸ’á–áŸáŸ‹á”áŸ†á•á»á',
        dpiLabel: 'á‚á»áá—á¶á– (DPI)', roundLabel: 'ášá¼á”áŸá‰áŸ’á‰á¶á˜á¼á›',
        yes: 'á”á¶á‘/á…á¶áŸ', no: 'á‘áŸ',
        fgLabel: 'á–ááŸŒá˜á»á', bgLabel: 'á–ááŸŒáá¶á„á€áŸ’ášáŸ„á™',
        logoBgLabel: 'á–ááŸŒáá¶á„á€áŸ’ášáŸ„á™ášá¼á”áŸá‰áŸ’á‰á¶',
        captionLabel: 'á¢ááŸ’áá”á‘á›á¾á€á¼áŠ',
        logoLabel: 'á‡áŸ’ášá¾áŸášá¾áŸášá¼á”á—á¶á–',
        logoUploadBtn: 'ğŸ“ á‡áŸ’ášá¾áŸášá¼á”á—á¶á–',
        btnGenerate: 'âœ¨ á”á„áŸ’á€á¾áá€á¼áŠ QR',
        btnClear: 'áŸá˜áŸ’á¢á¶á',
        btnDownload: 'ğŸ“¥ á‘á¶á‰á™á€',
        btnShare: 'ğŸ“¤ á…áŸ‚á€ášáŸ†á›áŸ‚á€',
        btnHelp: 'á‡áŸ†á“á½á™',
        btnAbout: 'á¢áŸ†á–á¸',
        btnUpdate: 'ğŸ”„ á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“á—á¶á–',
        previewHint: 'á”á‰áŸ’á…á¼á›á¢ááŸ’áá”á‘ á á¾á™á…á»á…á”á„áŸ’á€á¾á',
        alertEnterText: 'áŸá¼á˜á”á‰áŸ’á…á¼á›á¢ááŸ’áá”á‘ á¬ URL',
        downloadFormatLabel: 'á‘á˜áŸ’ášá„áŸ‹á‘á¶á‰á™á€áŸ–',
        shareToLabel: 'á…áŸ‚á€ášáŸ†á›áŸ‚á€á‘áŸ…áŸ–',
        welcomeTitle: 'ğŸ‰ áŸá¼á˜áŸáŸ’áœá¶á‚á˜á“áŸ',
        btnEnterLicense: 'âœ… á”á‰áŸ’á…á¼á›á›áŸáá€á¼áŠ',
        btnSkipTrial: 'â­ï¸ áŸá¶á€á›áŸ’á”á„',
        trialModeInfo: 'á˜áŸ‰á¼áŠáŸá¶á€á›áŸ’á”á„áŸ– á”á„áŸ’á€á¾á QR áŠáŸ„á™áŸáŸášá¸<br>á›á¸áŸá·á“áŸ’áŸáŸ– áŠáŸ„áŸ‡áŸáŸ„á‘á¶á‰á™á€',
        btnActivateLicense: 'âœ… áŠá¶á€áŸ‹á€á¼áŠá€á˜áŸ’á˜áŸá·á‘áŸ’á’á·',
        btnCancelLicense: 'á”áŸ„áŸ‡á”á„áŸ‹',
        btnActivate: 'ğŸ”“ áŠá¶á€áŸ‹á€á¼áŠá€á˜áŸ’á˜áŸá·á‘áŸ’á’á·',
        btnDeactivate: 'ğŸ”’ á•áŸ’áá¶á…áŸ‹áŠá¼á€á€á˜áŸ’á˜áŸá·á‘áŸ’á’á·',
        alertEnterLicense: 'âŒ áŸá¼á˜á”á‰áŸ’á…á¼á›á›áŸáá€á¼áŠ',
        alertInvalidLicense: 'âŒ á‘á˜áŸ’ášá„áŸ‹á˜á·á“ááŸ’ášá¹á˜ááŸ’ášá¼áœ',
        helpTitle: 'á‡áŸ†á“á½á™ - KMQR',
        aboutTitle: 'á¢áŸ†á–á¸á€á˜áŸ’á˜áœá·á’á¸',
        version: 'á‡áŸ†á“á¶á“áŸ‹ áŸ¡.áŸ .áŸ¨',
        developerLabel: 'ğŸ‘¨â€ğŸ’» á¢áŸ’á“á€á”á„áŸ’á€á¾ááŸ–',
        developer: 'ááŸ‚á˜ á˜á¸<br><em>á¢áŸ’á“á€á¢á—á·áœáŒáŸ’á</em>',
        deviceIdLabel: 'á›áŸááŸá˜áŸ’á‚á¶á›áŸ‹áŸ–',
        licenseModalTitle: 'ğŸ”“ á”á‰áŸ’á…á¼á›á›áŸáá€á¼áŠ',
        licenseInstructions: '<strong>á”á‰áŸ’á…á¼á›á›áŸáá€á¼áŠášá”áŸáŸ‹á¢áŸ’á“á€áá¶á„á€áŸ’ášáŸ„á˜áŠá¾á˜áŸ’á”á¸áŠáŸ„áŸ‡áŸáŸ„á˜á»áá„á¶ášá–áŸá‰á›áŸá‰áŸ–</strong>',
        licenseInputPlaceholder: 'á”á‰áŸ’á…á¼á›á›áŸáá€á¼áŠášá”áŸáŸ‹á¢áŸ’á“á€á“áŸ…á‘á¸á“áŸáŸ‡...',
        licenseContactInfo: 'ğŸ“§ á˜á·á“á˜á¶á“á›áŸáá€á¼áŠá‘áŸ?<br>á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„áŸ– <strong><a href="mailto:my.khem.mathst@gmail.com" style="color:#3b82f6;">my.khem.mathst@gmail.com</a></strong><br>ğŸ“± á‘á¼ášáŸáŸá–áŸ’á‘áŸ– <strong><a href="tel:+85566931319" style="color:#3b82f6;">+855 66/99 931319</a></strong><br>ğŸ’¬ TelegramáŸ– <strong><a href="https://t.me/khemmy99" target="_blank" style="color:#3b82f6;">@khemmy99</a></strong>',
        alertLogoFailed: 'á”ášá¶á‡áŸá™á€áŸ’á“á»á„á€á¶ášá•áŸ’á‘á»á€ášá¼á”á—á¶á–á¡á¼á áŸ’á‚áŸ„áŸ”',
        alertError: 'á€áŸ†á á»áŸ',
        alertDownloadLocked: 'ğŸ”’ á€á¶ášá‘á¶á‰á™á€ááŸ’ášá¼áœá”á¶á“á…á¶á€áŸ‹áŸáŸ„áŸ” á…á»á…á”á¼áá»á„á–ááŸá”áŸƒáá„á”á‰áŸ’á‡á¼á›á€á¼áŠá€á˜áŸ’á˜áŸá·á‘áŸ’á’á·áŠá¾á˜áŸ’á”á¸á‘á¶á‰á™á€!',
        alertGenerateFirst: 'áŸá¼á˜á”á„áŸ’á€á¾áá€á¼áŠ QR á˜á»á“áŸá·á“',
        alertCopied: 'á”á¶á“á…á˜áŸ’á›á„!',
        confirmDeactivate: 'á”á·á‘áŸá€á˜áŸ’á˜?',
        logoSelected: 'á”á¶á“á‡áŸ’ášá¾áŸášá¾áŸášá¼á”áŸá‰áŸ’á‰á¶',
        footerPhone: 'á‘á¼ášáŸáŸá–áŸ’á‘:',
        footerTelegram: 'ááŸá›áŸá€áŸ’ášá¶á˜:',
        footerFacebook: 'á áŸ’áœáŸá€á”á»á€:',
        footerCopyright: 'ášá€áŸ’áŸá¶áŸá·á‘áŸ’á’á·:',
        footerRights: 'ášá€áŸ’áŸá¶áŸá·á‘áŸ’á’á·á‚áŸ’ášá”áŸ‹á™áŸ‰á¶á„áŸ”',
        footerAuthor: 'ááŸ‚á˜ á˜á¸',
        alertCopied: 'á”á¶á“á…á˜áŸ’á›á„á á¾á™!',
        confirmDeactivate: 'á•áŸ’áá¶á…áŸ‹áŸá·á‘áŸ’á’á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹á–áŸá‰á›áŸá‰?',
        logoSelected: 'á”á¶á“á‡áŸ’ášá¾áŸášá¾áŸá¡á¼á áŸ’á‚áŸ„',
        textPlaceholder: 'á”á‰áŸ’á…á¼á›á¢ááŸ’áá”á‘, URL, á¬á—á¶áŸá¶ááŸ’á˜áŸ‚ášâ€¦',
        overlayPlaceholder: 'á§. ááŸ‚á˜â€‹ á˜á¸',
        btnClose: 'á”á·á‘',
      }
    };

    function updateLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('kmqr_lang', lang);
      const t = translations[lang];
      
      // Change font based on language
      const kmFont = "'Siemreap', 'Hanuman', Arial, sans-serif";
      const enFont = "Arial, 'Segoe UI', Roboto, sans-serif";
      const selectedFont = lang === 'km' ? kmFont : enFont;
      
      document.body.style.fontFamily = selectedFont;
      
      // Update font for all select elements and their options
      const selectElements = document.querySelectorAll('select, select option');
      selectElements.forEach(el => {
        el.style.fontFamily = selectedFont;
      });
      
      if (document.getElementById('title')) document.getElementById('title').textContent = t.title;
      if (document.getElementById('textLabel')) document.getElementById('textLabel').textContent = t.textLabel;
      if (document.getElementById('sizeLabel')) document.getElementById('sizeLabel').textContent = t.sizeLabel;
      if (document.getElementById('ecLabel')) document.getElementById('ecLabel').textContent = t.ecLabel;
      if (document.getElementById('ecLow')) document.getElementById('ecLow').textContent = t.ecLow;
      if (document.getElementById('ecMedium')) document.getElementById('ecMedium').textContent = t.ecMedium;
      if (document.getElementById('ecQuartile')) document.getElementById('ecQuartile').textContent = t.ecQuartile;
      if (document.getElementById('ecHigh')) document.getElementById('ecHigh').textContent = t.ecHigh;
      if (document.getElementById('dpiLabel')) document.getElementById('dpiLabel').textContent = t.dpiLabel;
      if (document.getElementById('roundLabel')) document.getElementById('roundLabel').textContent = t.roundLabel;
      if (document.getElementById('yes')) document.getElementById('yes').textContent = t.yes;
      if (document.getElementById('no')) document.getElementById('no').textContent = t.no;
      if (document.getElementById('fgLabel')) document.getElementById('fgLabel').textContent = t.fgLabel;
      if (document.getElementById('bgLabel')) document.getElementById('bgLabel').textContent = t.bgLabel;
      if (document.getElementById('logoBgLabel')) document.getElementById('logoBgLabel').textContent = t.logoBgLabel;
      if (document.getElementById('captionLabel')) document.getElementById('captionLabel').textContent = t.captionLabel;
      if (document.getElementById('logoLabel')) document.getElementById('logoLabel').textContent = t.logoLabel;
      if (document.getElementById('logoUploadBtn')) document.getElementById('logoUploadBtn').textContent = t.logoUploadBtn;
      if (document.getElementById('btnGenerate')) document.getElementById('btnGenerate').textContent = t.btnGenerate;
      if (document.getElementById('btnClear')) document.getElementById('btnClear').textContent = t.btnClear;
      if (document.getElementById('btnShare')) document.getElementById('btnShare').textContent = t.btnShare;
      if (document.getElementById('btnDownload')) document.getElementById('btnDownload').textContent = t.btnDownload;
      if (document.getElementById('previewHint')) document.getElementById('previewHint').textContent = t.previewHint;
      if (document.getElementById('downloadFormatLabel')) document.getElementById('downloadFormatLabel').textContent = t.downloadFormatLabel;
      if (document.getElementById('shareToLabel')) document.getElementById('shareToLabel').textContent = t.shareToLabel;
      if (document.getElementById('helpTitle')) document.getElementById('helpTitle').textContent = t.helpTitle;
      if (document.getElementById('aboutTitle')) document.getElementById('aboutTitle').textContent = t.aboutTitle;
      if (document.getElementById('welcomeTitle')) document.getElementById('welcomeTitle').textContent = t.welcomeTitle;
      if (document.getElementById('btnEnterLicense')) document.getElementById('btnEnterLicense').textContent = t.btnEnterLicense;
      if (document.getElementById('btnSkipTrial')) document.getElementById('btnSkipTrial').textContent = t.btnSkipTrial;
      if (document.getElementById('trialModeInfo')) document.getElementById('trialModeInfo').innerHTML = t.trialModeInfo;
      if (document.getElementById('btnActivateLicense')) document.getElementById('btnActivateLicense').textContent = t.btnActivateLicense;
      if (document.getElementById('btnCancelLicense')) document.getElementById('btnCancelLicense').textContent = t.btnCancelLicense;
      if (document.getElementById('deviceIdInfo')) updateDeviceIdInfo();
      
      // Update header buttons
      if (document.getElementById('btnHelp2Text')) document.getElementById('btnHelp2Text').textContent = t.btnHelp;
      if (document.getElementById('btnAbout2')) document.getElementById('btnAbout2').textContent = t.btnAbout;
      if (document.getElementById('updateCheckBtn')) document.getElementById('updateCheckBtn').textContent = t.btnUpdate;
      
      // Update close buttons
      if (document.getElementById('updateCloseBtn')) document.getElementById('updateCloseBtn').textContent = t.btnClose;
      if (document.getElementById('helpCloseBtn')) document.getElementById('helpCloseBtn').textContent = t.btnClose;
      if (document.getElementById('aboutCloseBtn')) document.getElementById('aboutCloseBtn').textContent = t.btnClose;
      
      // Update license modal content
      if (document.getElementById('licenseModalTitle')) document.getElementById('licenseModalTitle').innerHTML = t.licenseModalTitle;
      if (document.getElementById('licenseInstructions')) document.getElementById('licenseInstructions').innerHTML = t.licenseInstructions;
      if (document.getElementById('licenseCodeInput')) document.getElementById('licenseCodeInput').placeholder = t.licenseInputPlaceholder;
      if (document.getElementById('qrText')) document.getElementById('qrText').placeholder = t.textPlaceholder;
      if (document.getElementById('overlayText')) document.getElementById('overlayText').placeholder = t.overlayPlaceholder;
      if (document.getElementById('licenseContactInfo')) document.getElementById('licenseContactInfo').innerHTML = t.licenseContactInfo;
      
      const btnToggle = document.getElementById('langToggle');
      if (btnToggle) {
        btnToggle.textContent = lang === 'en' ? 'ğŸŒ ááŸ’á˜áŸ‚áš' : 'ğŸŒ English';
      }
      
      // Update activate button text when language changes
      const activateBtn = document.getElementById('activateBtn');
      if (activateBtn) {
        const isActivated = localStorage.getItem('kmqr_app_activated') === 'true';
        if (isActivated) {
          activateBtn.textContent = t.btnDeactivate;
        } else {
          activateBtn.textContent = t.btnActivate;
        }
      }
      
      // Update footer translations
      if (document.getElementById('footerPhoneLabel')) document.getElementById('footerPhoneLabel').textContent = t.footerPhone;
      if (document.getElementById('footerTelegramLabel')) document.getElementById('footerTelegramLabel').textContent = t.footerTelegram;
      if (document.getElementById('footerFacebookLabel')) document.getElementById('footerFacebookLabel').textContent = t.footerFacebook;
      if (document.getElementById('footerCopyrightLabel')) document.getElementById('footerCopyrightLabel').textContent = t.footerCopyright;
      if (document.getElementById('footerRightsText')) document.getElementById('footerRightsText').textContent = t.footerRights;
      if (document.getElementById('footerAuthorName')) document.getElementById('footerAuthorName').textContent = t.footerAuthor;
    }

    const langToggleBtn = document.getElementById('langToggle');
    if (langToggleBtn) {
      langToggleBtn.addEventListener('click', () => {
        const newLang = currentLang === 'en' ? 'km' : 'en';
        updateLanguage(newLang);
        updateActivationStatus();
      });
    }

    function updateActivationStatus() {
      const isActivated = localStorage.getItem('kmqr_app_activated') === 'true';
      const activateBtn = document.getElementById('activateBtn');
      
      if (activateBtn) {
        if (isActivated) {
          activateBtn.textContent = translations[currentLang].btnDeactivate;
          activateBtn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
          activateBtn.onclick = function() {
            if (confirm(translations[currentLang].confirmDeactivate)) {
              localStorage.removeItem('kmqr_app_activated');
              localStorage.removeItem('kmqr_license_code');
              localStorage.removeItem('kmqr_welcome_shown');
              document.getElementById('licenseModal').classList.add('active');
              document.getElementById('licenseModal').style.display = 'flex';
              document.querySelectorAll('.container').forEach(el => el.style.display = 'none');
              document.querySelectorAll('.main-wrapper').forEach(el => el.style.display = 'none');
              updateActivationStatus();
            }
          };
        } else {
          activateBtn.textContent = translations[currentLang].btnActivate;
          activateBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
          activateBtn.onclick = function() {
            document.getElementById('licenseModal').classList.add('active');
            document.getElementById('licenseModal').style.display = 'flex';
          };
        }
      }
    }

    const btnGenerate = document.getElementById('btnGenerate');
    const btnDownload = document.getElementById('btnDownload');
    const btnClear = document.getElementById('btnClear');
    const btnShare = document.getElementById('btnShare');
    const qrPreview = document.getElementById('qrPreview');
    const elText = document.getElementById('qrText');
    const elSize = document.getElementById('qrSize');
    const elEC = document.getElementById('qrEC');
    const elFG = document.getElementById('qrFG');
    const elBG = document.getElementById('qrBG');
    const elDpi = document.getElementById('dpiScale');
    const elLogoBg = document.getElementById('logoBg');
    const elLogoRound = document.getElementById('logoRound');
    const elOverlay = document.getElementById('overlayText');

    btnGenerate.addEventListener('click', () => {
      if (!elText.value) {
        alert(translations[currentLang].alertEnterText);
        return;
      }

      try {
        qrPreview.innerHTML = '';
        const size = parseInt(elSize.value);
        const dpi = parseInt(elDpi.value);

        const tempDiv = document.createElement('div');
        tempDiv.style.display = 'none';
        document.body.appendChild(tempDiv);

        new QRCode(tempDiv, {
          text: elText.value,
          width: size,
          height: size,
          colorDark: elFG.value,
          colorLight: elBG.value,
          correctLevel: QRCode.CorrectLevel[elEC.value]
        });

        setTimeout(() => {
          const qrCanvas = tempDiv.querySelector('canvas');
          if (!qrCanvas) return;

          const previewCanvas = document.createElement('canvas');
          previewCanvas.width = size;
          previewCanvas.height = size;
          const ctx = previewCanvas.getContext('2d');

          ctx.fillStyle = elBG.value;
          ctx.fillRect(0, 0, size, size);
          ctx.drawImage(qrCanvas, 0, 0);

          // Add logo overlay if logo is uploaded
          if (logoImage) {
            const logoSize = size * 0.25; // Logo is 25% of QR size
            const logoX = (size - logoSize) / 2;
            const logoY = (size - logoSize) / 2;
            const isRound = elLogoRound.value === 'yes';
            const logoBgColor = elLogoBg.value;
            
            // Draw logo background
            ctx.fillStyle = logoBgColor;
            if (isRound) {
              ctx.beginPath();
              ctx.arc(size / 2, size / 2, logoSize / 2 + 4, 0, Math.PI * 2);
              ctx.fill();
            } else {
              ctx.fillRect(logoX - 4, logoY - 4, logoSize + 8, logoSize + 8);
            }
            
            // Draw logo with clipping for round option
            if (isRound) {
              ctx.save();
              ctx.beginPath();
              ctx.arc(size / 2, size / 2, logoSize / 2, 0, Math.PI * 2);
              ctx.clip();
              ctx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
              ctx.restore();
            } else {
              ctx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
            }
          }

          // Add overlay text if provided - below QR code
          const overlayText = elOverlay.value.trim();
          const textHeight = overlayText ? 24 : 0;
          
          // Create final preview canvas with extra space for text
          const finalPreviewCanvas = document.createElement('canvas');
          finalPreviewCanvas.width = size;
          finalPreviewCanvas.height = size + textHeight;
          const finalCtx = finalPreviewCanvas.getContext('2d');
          
          // Draw background for full canvas
          finalCtx.fillStyle = elBG.value;
          finalCtx.fillRect(0, 0, finalPreviewCanvas.width, finalPreviewCanvas.height);
          
          // Draw QR code from preview canvas
          finalCtx.drawImage(previewCanvas, 0, 0);
          
          // Add overlay text below QR code
          if (overlayText) {
            finalCtx.font = 'bold 14px Arial, sans-serif';
            finalCtx.fillStyle = elFG.value;
            finalCtx.textAlign = 'center';
            finalCtx.fillText(overlayText, size / 2, size + 16);
          }

          qrPreview.appendChild(finalPreviewCanvas);

          // Create export canvas with DPI scaling and extra space for text
          const exportTextHeight = overlayText ? 24 * dpi : 0;
          const exportCanvasEl = document.createElement('canvas');
          exportCanvasEl.width = size * dpi;
          exportCanvasEl.height = size * dpi + exportTextHeight;
          const expCtx = exportCanvasEl.getContext('2d');

          expCtx.fillStyle = elBG.value;
          expCtx.fillRect(0, 0, exportCanvasEl.width, exportCanvasEl.height);
          expCtx.drawImage(qrCanvas, 0, 0, size, size, 0, 0, size * dpi, size * dpi);

          // Add logo overlay to export canvas
          if (logoImage) {
            const logoSize = size * dpi * 0.25;
            const logoX = (size * dpi - logoSize) / 2;
            const logoY = (size * dpi - logoSize) / 2;
            const isRound = elLogoRound.value === 'yes';
            const logoBgColor = elLogoBg.value;
            
            expCtx.fillStyle = logoBgColor;
            if (isRound) {
              expCtx.beginPath();
              expCtx.arc(size * dpi / 2, size * dpi / 2, logoSize / 2 + 4 * dpi, 0, Math.PI * 2);
              expCtx.fill();
              
              expCtx.save();
              expCtx.beginPath();
              expCtx.arc(size * dpi / 2, size * dpi / 2, logoSize / 2, 0, Math.PI * 2);
              expCtx.clip();
              expCtx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
              expCtx.restore();
            } else {
              expCtx.fillRect(logoX - 4 * dpi, logoY - 4 * dpi, logoSize + 8 * dpi, logoSize + 8 * dpi);
              expCtx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
            }
          }

          // Add overlay text to export canvas - below QR code
          if (overlayText) {
            expCtx.font = 'bold ' + (14 * dpi) + 'px Arial, sans-serif';
            expCtx.fillStyle = elFG.value;
            expCtx.textAlign = 'center';
            expCtx.fillText(overlayText, size * dpi / 2, size * dpi + 16 * dpi);
          }

          exportCanvas = exportCanvasEl;
          btnDownload.disabled = false;
          btnShare.disabled = false;
          document.body.removeChild(tempDiv);
        }, 100);
      } catch (err) {
        alert(translations[currentLang].alertError + ': ' + err.message);
      }
    });

    window.downloadCanvas = function(format) {
      if (!exportCanvas) return;
      const isActivated = localStorage.getItem('kmqr_app_activated') === 'true';
      if (!isActivated) {
        alert(translations[currentLang].alertDownloadLocked);
        return;
      }
      
      if (format === 'png') {
        const link = document.createElement('a');
        link.download = 'KMQR-' + Date.now() + '.png';
        link.href = exportCanvas.toDataURL('image/png');
        link.click();
      } else if (format === 'jpg') {
        const link = document.createElement('a');
        link.download = 'KMQR-' + Date.now() + '.jpg';
        link.href = exportCanvas.toDataURL('image/jpeg', 0.95);
        link.click();
      } else if (format === 'pdf') {
        // Use html2pdf to generate proper single-page PDF
        const imgData = exportCanvas.toDataURL('image/png');
        const pdfContainer = document.createElement('div');
        pdfContainer.style.cssText = 'display:flex;justify-content:center;align-items:center;padding:20px;background:#fff;';
        const img = document.createElement('img');
        img.src = imgData;
        img.style.cssText = 'max-width:100%;height:auto;';
        pdfContainer.appendChild(img);
        
        const opt = {
          margin: 10,
          filename: 'KMQR-' + Date.now() + '.pdf',
          image: { type: 'png', quality: 1 },
          html2canvas: { scale: 2, useCORS: true },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
          pagebreak: { mode: 'avoid-all' }
        };
        
        html2pdf().set(opt).from(pdfContainer).save().then(function() {
          // PDF saved successfully, user stays in app
        });
      }
    };

    document.getElementById('downloadPNG').addEventListener('click', () => downloadCanvas('png'));
    document.getElementById('downloadJPG').addEventListener('click', () => downloadCanvas('jpg'));
    document.getElementById('downloadPDF').addEventListener('click', () => downloadCanvas('pdf'));

    window.shareToSocial = function(platform) {
      if (!elText.value) {
        alert(translations[currentLang].alertGenerateFirst);
        return;
      }
      const text = encodeURIComponent('KMQR: ' + elText.value);
      
      if (platform === 'copy') {
        navigator.clipboard.writeText(elText.value).then(() => {
          alert(translations[currentLang].alertCopied);
        });
      } else if (platform === 'whatsapp') {
        window.open('https://wa.me/?text=' + text);
      }
    };

    document.getElementById('shareWhatsApp').addEventListener('click', () => shareToSocial('whatsapp'));
    document.getElementById('shareCopy').addEventListener('click', () => shareToSocial('copy'));

    btnClear.addEventListener('click', () => {
      qrPreview.innerHTML = '<p id="previewHint">' + translations[currentLang].previewHint + '</p>';
      elText.value = '';
      elOverlay.value = '';
      exportCanvas = null;
      logoImage = null;
      btnDownload.disabled = true;
      btnShare.disabled = true;
      // Reset logo preview
      document.getElementById('logoPreview').innerHTML = '';
      document.getElementById('logoPreview').style.display = 'none';
      document.getElementById('logoUpload').value = '';
      // Reset color pickers to default
      document.getElementById('qrFG').value = '#000000';
      document.getElementById('qrBG').value = '#ffffff';
      document.getElementById('logoBg').value = '#ffffff';
      // Reset selects to default
      document.getElementById('qrSize').value = '200';
      document.getElementById('qrEC').value = 'M';
      document.getElementById('dpiScale').value = '2';
      document.getElementById('logoRound').value = 'yes';
      // Hide menus
      document.getElementById('downloadMenu').style.display = 'none';
      document.getElementById('shareMenu').style.display = 'none';
    });

    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.remove('active');
          modal.style.display = 'none';
        }
      });
    });

    // Generate app icon with white background using existing icon
    function generateAppIcon() {
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = function() {
        const canvas = document.createElement('canvas');
        canvas.width = 180;
        canvas.height = 180;
        const ctx = canvas.getContext('2d');
        
        // White rounded background
        ctx.fillStyle = '#ffffff';
        ctx.beginPath();
        ctx.roundRect(0, 0, 180, 180, 36);
        ctx.fill();
        ctx.clip();
        
        // Draw the logo centered with padding
        const padding = 20;
        const size = 180 - (padding * 2);
        ctx.drawImage(img, padding, padding, size, size);
        
        // Update icon links
        const iconData = canvas.toDataURL('image/png');
        const iconLinks = document.querySelectorAll('link[rel="apple-touch-icon"]');
        iconLinks.forEach(link => {
          link.href = iconData;
        });
      };
      img.src = 'icon.png';
    }
    
    generateAppIcon();
    updateLanguage(currentLang);
    updateActivationStatus();
    initializeWelcome();
    checkForUpdates();
  </script>
</body>
</html>
